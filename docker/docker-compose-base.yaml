version: '2'

services:

  redis:
    image: redis:3
    # ports:
    #  - 6379:6379
    command: redis-server --appendonly no --appendfsync no --stop-writes-on-bgsave-error no --maxmemory 1gb
    logging:
      driver: none

  dynamo:
    image: ${DYNAMO_IMAGE_NAME_FULL}
#    ports:
#      - 8000:8000
    volumes:
      # >..< because this file is nested one level deep. We keep the directory
      # around so that data is available between restarts
      - ../dynamodata:${DYNAMODIR}

  app:
    image: ${IMAGE_NAME_FULL}
    environment:
      USER_ID: ${USER_ID}
      GROUP_ID: ${GROUP_ID}
      # in local dev set up we override DynamoDB host value on all Dynamo models
      # http://pynamodb.readthedocs.io/en/latest/local.html
      APP_DYNAMODB_HOST: "http://dynamo:8000"
    volumes:
      # >..< because this file is nested one level deep
      - ..:${WORKDIR}
